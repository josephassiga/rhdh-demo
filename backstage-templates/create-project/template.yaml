apiVersion: scaffolder.backstage.io/v1beta3
kind: Template
metadata:
  name: project-template
  title: Project Request Template
  description: Project the Creation of an environment 
  tags:
    - recommended
    - environment
    - provisioning
spec:
  owner: service@example.com
  type: service

  parameters:
    - title: Environment Request
      required:
        - project
        - description
        - team
        - environment
      properties:
        project:
          title: Project
          type: string
          description: Project or namespace that will contains ressources for the applications    
        description:
          title: Description
          type: string
          description: Short description for this environment       
        environment:
          title: Environment
          type: string
          enum: ["dev", "qa", "prod"]
          description: Purpose for this environment                   
        team:
          title: Teams
          type: string
          description: Member of the project
          ui:field: OwnerPicker
          ui:options:
            allowedKinds: 
              - Group

  steps:
    - id: template
      name: Code Fetch Skeleton + Template
      action: fetch:template
      input:
        url: ./skeleton
        values:
          description: ${{ parameters.description }}
          team: ${{ parameters.team.split("/")[1] }}
          project: ${{ parameters.project }}
          environment: ${{ parameters.environment }}

    - id: pull-request
      name: Create a Pull Request to create a new project.
      action: publish:github:pull-request
      input:
        allowedHosts: ['github.com']
        repoUrl: github.com?repo=rhdh-demo&owner=josephassiga
        title: "Create new project: ${{ parameters.project }}"
        description: This is a request for the creation of the namespace ${{ parameters.project }}
        branchName: create-ns-${{parameters.project}}
        sourcePath: ./source

  output:
    links:
      - title: View the Source Repository
        url: ${{ ssteps.pull-request.output.remoteUrl.output.remoteUrl }}
                               